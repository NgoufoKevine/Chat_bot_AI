<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EASE Travel KB Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .tabs {
            display: flex;
            background: #f5f7fa;
            border-bottom: 2px solid #e1e8ed;
        }
        
        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: transparent;
            font-size: 16px;
            font-weight: 500;
        }
        
        .tab:hover {
            background: #e8ecf1;
        }
        
        .tab.active {
            background: white;
            border-bottom: 3px solid #667eea;
            color: #667eea;
        }
        
        .content {
            padding: 30px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group textarea {
            min-height: 200px;
            resize: vertical;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: #f5f7fa;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e1e8ed;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
        }
        
        .stat-card p {
            opacity: 0.9;
        }
        
        .document-list {
            margin-top: 20px;
        }
        
        .document-item {
            background: #f5f7fa;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .document-item h4 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .document-item .meta {
            display: flex;
            gap: 20px;
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .document-item .content-preview {
            color: #555;
            line-height: 1.6;
            max-height: 60px;
            overflow: hidden;
            font-size: 14px;
        }
        
        .document-item .actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-faq { background: #e3f2fd; color: #1976d2; }
        .badge-policy { background: #f3e5f5; color: #7b1fa2; }
        .badge-info { background: #e8f5e9; color: #388e3c; }
        .badge-guide { background: #fff3e0; color: #f57c00; }
        
        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .info-message {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }
        
        .file-upload-area {
            border: 2px dashed #e1e8ed;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .file-upload-area:hover {
            border-color: #667eea;
            background: #f5f7fa;
        }
        
        .file-upload-area.drag-over {
            border-color: #667eea;
            background: #e8ecf1;
        }
        
        .upload-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .upload-tab {
            flex: 1;
            padding: 15px;
            background: #f5f7fa;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .upload-tab:hover {
            background: #e8ecf1;
        }
        
        .upload-tab.active {
            background: white;
            border-color: #667eea;
            color: #667eea;
        }
        
        .upload-form {
            display: none;
        }
        
        .upload-form.active {
            display: block;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Knowledge Base Manager</h1>
            <p>EASE Travel AI Assistant - Admin Portal</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchMainTab('add')">‚ûï Add Content</button>
            <button class="tab" onclick="switchMainTab('manage')">üìã Manage</button>
            <button class="tab" onclick="switchMainTab('stats')">üìä Statistics</button>
        </div>
        
        <div class="content">
            <!-- Messages -->
            <div class="success-message" id="success-message"></div>
            <div class="error-message" id="error-message"></div>
            <div class="info-message" id="info-message"></div>
            
            <!-- Add Content Tab -->
            <div id="add-tab" class="tab-content active">
                <h2 style="margin-bottom: 25px;">Add New Content</h2>
                
                <div class="upload-tabs">
                    <div class="upload-tab active" onclick="switchUploadType('text')">
                        üìù Text Content
                    </div>
                    <div class="upload-tab" onclick="switchUploadType('pdf')">
                        üìÑ PDF Document
                    </div>
                </div>
                
                <!-- Text Upload Form -->
                <form id="text-form" class="upload-form active">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="text-collection">Collection *</label>
                            <select id="text-collection" required>
                                <option value="">Select collection...</option>
                                <option value="tourisme">üèñÔ∏è Tourisme</option>
                                <option value="hotel">üè® Hotel</option>
                                <option value="activites">üéØ Activit√©s</option>
                                <option value="appartements">üè† Appartements</option>
                                <option value="voiture">üöó Voiture</option>
                                <option value="visa">üìÑ Visa</option>
                                <option value="general">üí¨ General</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="text-doc-type">Document Type *</label>
                            <select id="text-doc-type" required>
                                <option value="">Select type...</option>
                                <option value="faq">FAQ</option>
                                <option value="guide">Guide</option>
                                <option value="policy">Policy</option>
                                <option value="info">Information</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="text-title">Title *</label>
                        <input type="text" id="text-title" required placeholder="Enter document title...">
                    </div>
                    
                    <div class="form-group">
                        <label for="text-content">Content *</label>
                        <textarea id="text-content" required placeholder="Enter the content here..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="text-category">Category/Tags</label>
                        <input type="text" id="text-category" placeholder="e.g., destinations, booking, requirements">
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button type="submit" class="btn btn-primary">üíæ Save Content</button>
                        <button type="reset" class="btn btn-secondary">üîÑ Reset</button>
                    </div>
                </form>
                
                <!-- PDF Upload Form -->
                <form id="pdf-form" class="upload-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pdf-collection">Collection *</label>
                            <select id="pdf-collection" required>
                                <option value="">Select collection...</option>
                                <option value="tourisme">üèñÔ∏è Tourisme</option>
                                <option value="hotel">üè® Hotel</option>
                                <option value="activites">üéØ Activit√©s</option>
                                <option value="appartements">üè† Appartements</option>
                                <option value="voiture">üöó Voiture</option>
                                <option value="visa">üìÑ Visa</option>
                                <option value="general">üí¨ General</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="pdf-doc-type">Document Type *</label>
                            <select id="pdf-doc-type" required>
                                <option value="">Select type...</option>
                                <option value="faq">FAQ</option>
                                <option value="guide">Guide</option>
                                <option value="policy">Policy</option>
                                <option value="info">Information</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="pdf-title">Title *</label>
                        <input type="text" id="pdf-title" required placeholder="Enter document title...">
                    </div>
                    
                    <div class="form-group">
                        <label for="pdf-category">Category/Tags</label>
                        <input type="text" id="pdf-category" placeholder="e.g., destinations, booking, requirements">
                    </div>
                    
                    <div class="form-group">
                        <label>PDF File *</label>
                        <div class="file-upload-area" id="pdf-upload-area">
                            <div style="font-size: 3em; margin-bottom: 10px;">üìÑ</div>
                            <p style="font-size: 18px; margin-bottom: 10px;">Drop PDF file here or click to browse</p>
                            <p style="color: #666; font-size: 14px;">Maximum file size: 10MB</p>
                            <input type="file" id="pdf-file" accept=".pdf" style="display: none;">
                        </div>
                        <div id="selected-file" style="margin-top: 10px; display: none;">
                            <strong>Selected:</strong> <span id="file-name"></span>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button type="submit" class="btn btn-primary">üì§ Upload PDF</button>
                        <button type="reset" class="btn btn-secondary">üîÑ Reset</button>
                    </div>
                </form>
                
                <!-- Loading indicator -->
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Processing document...</p>
                </div>
            </div>
            
            <!-- Manage Tab -->
            <div id="manage-tab" class="tab-content">
                <h2 style="margin-bottom: 25px;">Manage Content</h2>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <input type="text" id="search-input" placeholder="üîç Search documents..." 
                               style="margin-bottom: 0;">
                    </div>
                    <div class="form-group">
                        <select id="filter-collection" style="margin-bottom: 0;">
                            <option value="">All Collections</option>
                            <option value="tourisme">üèñÔ∏è Tourisme</option>
                            <option value="hotel">üè® Hotel</option>
                            <option value="activites">üéØ Activit√©s</option>
                            <option value="appartements">üè† Appartements</option>
                            <option value="voiture">üöó Voiture</option>
                            <option value="visa">üìÑ Visa</option>
                            <option value="general">üí¨ General</option>
                        </select>
                    </div>
                </div>
                
                <div class="document-list" id="document-list">
                    <p style="text-align: center; color: #666; padding: 40px;">
                        Loading documents...
                    </p>
                </div>
            </div>
            
            <!-- Statistics Tab -->
            <div id="stats-tab" class="tab-content">
                <h2 style="margin-bottom: 25px;">Knowledge Base Statistics</h2>
                
                <div class="stats-grid" id="stats-grid">
                    <div class="stat-card">
                        <h3 id="total-docs">-</h3>
                        <p>Total Documents</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="total-chunks">-</h3>
                        <p>Total Chunks</p>
                    </div>
                </div>
                
                <div style="background: #f5f7fa; padding: 25px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">Documents by Collection</h3>
                    <div id="collection-stats" style="display: grid; gap: 10px;">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Utiliser chemin relatif au lieu de localhost
        const API_BASE = '/api';  // Au lieu de 'http://localhost:8001/api'
        
        // Store credentials from initial page load (Basic Auth)
        let authCredentials = null;
        
        // Get credentials from browser's Basic Auth
        function getAuthHeader() {
            // Browser stores Basic Auth credentials automatically
            // We need to pass them with each fetch request
            return authCredentials;
        }
        
        // Tab switching
        function switchMainTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            if (tabName === 'manage') {
                loadDocuments();
            } else if (tabName === 'stats') {
                loadStatistics();
            }
        }
        
        function switchUploadType(type) {
            document.querySelectorAll('.upload-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.upload-form').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById(`${type}-form`).classList.add('active');
        }
        
        // Show messages
        function showMessage(type, text) {
            const messageEl = document.getElementById(`${type}-message`);
            messageEl.textContent = text;
            messageEl.style.display = 'block';
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 5000);
        }
        
        // Text form submission
        document.getElementById('text-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('collection', document.getElementById('text-collection').value);
            formData.append('doc_type', document.getElementById('text-doc-type').value);
            formData.append('title', document.getElementById('text-title').value);
            formData.append('content', document.getElementById('text-content').value);
            formData.append('category', document.getElementById('text-category').value);
            
            document.getElementById('loading').style.display = 'block';
            
            // Timeout de 2 minutes pour le premier embedding
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 120000); // 2 minutes
            
            try {
                const response = await fetch(`${API_BASE}/documents/add-text`, {
                    method: 'POST',
                    body: formData,
                    credentials: 'include',
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                const result = await response.json();
                
                if (response.ok) {
                    showMessage('success', `‚úì ${result.message} (${result.chunk_count} chunks created)`);
                    this.reset();
                } else {
                    if (response.status === 401) {
                        showMessage('error', '‚úó Authentication failed. Please refresh the page and login again.');
                    } else {
                        showMessage('error', `‚úó Error: ${result.detail}`);
                    }
                }
            } catch (error) {
                clearTimeout(timeoutId);
                if (error.name === 'AbortError') {
                    showMessage('error', '‚úó Request timeout. The first embedding can take 1-2 minutes. Please ensure Ollama is running (ollama serve) and try again.');
                } else {
                    showMessage('error', `‚úó Network error: ${error.message}. Please check: 1) Ollama is running (ollama serve), 2) API server is running (python kb_admin_api.py)`);
                }
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        });
        
        // PDF upload handling
        const pdfUploadArea = document.getElementById('pdf-upload-area');
        const pdfFileInput = document.getElementById('pdf-file');
        
        pdfUploadArea.addEventListener('click', () => pdfFileInput.click());
        
        pdfFileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                document.getElementById('file-name').textContent = this.files[0].name;
                document.getElementById('selected-file').style.display = 'block';
            }
        });
        
        // Drag and drop
        pdfUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            pdfUploadArea.classList.add('drag-over');
        });
        
        pdfUploadArea.addEventListener('dragleave', () => {
            pdfUploadArea.classList.remove('drag-over');
        });
        
        pdfUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            pdfUploadArea.classList.remove('drag-over');
            
            if (e.dataTransfer.files.length > 0) {
                pdfFileInput.files = e.dataTransfer.files;
                document.getElementById('file-name').textContent = e.dataTransfer.files[0].name;
                document.getElementById('selected-file').style.display = 'block';
            }
        });
        
        // PDF form submission
        document.getElementById('pdf-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const fileInput = document.getElementById('pdf-file');
            if (!fileInput.files.length) {
                showMessage('error', '‚úó Please select a PDF file');
                return;
            }
            
            const formData = new FormData();
            formData.append('collection', document.getElementById('pdf-collection').value);
            formData.append('doc_type', document.getElementById('pdf-doc-type').value);
            formData.append('title', document.getElementById('pdf-title').value);
            formData.append('category', document.getElementById('pdf-category').value);
            formData.append('file', fileInput.files[0]);
            
            document.getElementById('loading').style.display = 'block';
            
            // Timeout de 3 minutes pour PDF (extraction + embedding)
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 180000); // 3 minutes
            
            try {
                const response = await fetch(`${API_BASE}/documents/add-pdf`, {
                    method: 'POST',
                    body: formData,
                    credentials: 'include',
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                const result = await response.json();
                
                if (response.ok) {
                    showMessage('success', `‚úì ${result.message} (${result.chunk_count} chunks created)`);
                    this.reset();
                    document.getElementById('selected-file').style.display = 'none';
                } else {
                    if (response.status === 401) {
                        showMessage('error', '‚úó Authentication failed. Please refresh the page and login again.');
                    } else {
                        showMessage('error', `‚úó Error: ${result.detail}`);
                    }
                }
            } catch (error) {
                clearTimeout(timeoutId);
                if (error.name === 'AbortError') {
                    showMessage('error', '‚úó Request timeout. Large PDFs can take 2-3 minutes. Please ensure Ollama is running and try again with a smaller PDF.');
                } else {
                    showMessage('error', `‚úó Network error: ${error.message}. Please check: 1) Ollama is running (ollama serve), 2) API server is running (python kb_admin_api.py)`);
                }
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        });
        
        // Load documents
        async function loadDocuments() {
            const listEl = document.getElementById('document-list');
            listEl.innerHTML = '<p style="text-align: center; padding: 40px;">Loading...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/documents/list`, {
                    credentials: 'include'  // Important
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load documents');
                }
                
                const result = await response.json();
                
                if (result.success) {
                    listEl.innerHTML = '';
                    
                    for (const [collectionName, docs] of Object.entries(result.documents)) {
                        if (docs.length === 0) continue;
                        
                        docs.forEach(doc => {
                            const docEl = document.createElement('div');
                            docEl.className = 'document-item';
                            docEl.innerHTML = `
                                <div class="meta">
                                    <span class="badge badge-${doc.doc_type}">${doc.doc_type.toUpperCase()}</span>
                                    <span>üìÅ ${collectionName}</span>
                                    <span>üìÖ ${new Date(doc.created_at).toLocaleDateString()}</span>
                                    <span>üì¶ ${doc.chunk_count} chunks</span>
                                    <span>üë§ ${doc.added_by || 'unknown'}</span>
                                </div>
                                <h4>${doc.title}</h4>
                                <div class="content-preview">${doc.content_preview}</div>
                                <div class="actions">
                                    <button class="btn btn-secondary" style="padding: 8px 16px; font-size: 14px; background: #fee; color: #c00;" 
                                            onclick="deleteDocument('${doc.id}', '${collectionName}')">
                                        üóëÔ∏è Delete
                                    </button>
                                </div>
                            `;
                            listEl.appendChild(docEl);
                        });
                    }
                    
                    if (listEl.children.length === 0) {
                        listEl.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">No documents found</p>';
                    }
                }
            } catch (error) {
                listEl.innerHTML = `<p style="text-align: center; color: #c00; padding: 40px;">Error loading documents: ${error.message}</p>`;
            }
        }
        
        // Delete document
        async function deleteDocument(docId, collection) {
            if (!confirm('Are you sure you want to delete this document?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/documents/${docId}?collection=${collection}`, {
                    method: 'DELETE',
                    credentials: 'include'  // Important
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showMessage('success', `‚úì ${result.message}`);
                    loadDocuments();
                } else {
                    showMessage('error', `‚úó Error: ${result.detail}`);
                }
            } catch (error) {
                showMessage('error', `‚úó Network error: ${error.message}`);
            }
        }
        
        // Load statistics
        async function loadStatistics() {
            try {
                const response = await fetch(`${API_BASE}/statistics`, {
                    credentials: 'include'  // Important
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load statistics');
                }
                
                const result = await response.json();
                
                if (result.success) {
                    const stats = result.statistics;
                    
                    document.getElementById('total-docs').textContent = stats.total_documents;
                    document.getElementById('total-chunks').textContent = stats.total_chunks;
                    
                    const collectionStatsEl = document.getElementById('collection-stats');
                    collectionStatsEl.innerHTML = '';
                    
                    for (const [collection, data] of Object.entries(stats.by_collection)) {
                        const statEl = document.createElement('div');
                        statEl.style.cssText = 'display: flex; justify-content: space-between; padding: 10px; background: white; border-radius: 6px;';
                        statEl.innerHTML = `
                            <span>${collection}</span>
                            <strong>${data.documents} docs (${data.chunks} chunks)</strong>
                        `;
                        collectionStatsEl.appendChild(statEl);
                    }
                }
            } catch (error) {
                showMessage('error', `Error loading statistics: ${error.message}`);
            }
        }
        
        // Search and filter
        document.getElementById('search-input').addEventListener('input', filterDocuments);
        document.getElementById('filter-collection').addEventListener('change', filterDocuments);
        
        function filterDocuments() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const filterColl = document.getElementById('filter-collection').value;
            
            document.querySelectorAll('.document-item').forEach(doc => {
                const text = doc.textContent.toLowerCase();
                const matchesSearch = text.includes(searchTerm);
                const matchesFilter = !filterColl || doc.textContent.includes(filterColl);
                
                doc.style.display = (matchesSearch && matchesFilter) ? 'block' : 'none';
            });
        }
    </script>
</body>
</html>